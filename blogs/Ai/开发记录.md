## 模型结构化输出差异

### content 和 tool_calls 输出

大部分模型在输出 tool_calls 工具命令时，一般较少输出正文 content ，这个一般是概率问题，目前 MiniMaxM2、qwen3-max、doubao-seed-1-6-251015 均可以；

可以使用提示词增强输出 tool_calls 命令时 content 的输出概率，但这只是概率增加；

```markdown
- 当你输出调用工具时。请同时输出调用该工具的理由和目的,以便用户理解你为什么要调用该工具，但要尽量隐藏工具具体信息
```

实际开发对于 content 、thiks（思考内容）、tool_calls 传输处理和前端渲染要注意分开处理；

### minimaxM2 模型 content 和 think 输出差异

minimax-m2 模型思考内容 think 默认内嵌到 content 中<think></think> 中输出；

minimax-m2 是交错思维模型，每次推理最好提供历史推理思考内容，这一能力使 M2 能够在长远且复杂的任务中表现出色。为了兼容大部分工具、平台、框架的 content 和 think 处理，模型默认将 think 放到 content ，避免后面回传丢失，丢失可能会影响模型的推理能力；

官方提供的api接口已经适配了大部分工具、框架等，自动将 content 和 think 在输出输入时处理，但大部分还需自己处理；

openaiSDK可加 `extra_body={"reasoning_split": True}`参数，将输出的 think 分离到 reasoning_split 对象；输入时还需要自己塞回去concant ，官方强烈建议开发者使用兼容交错思维的格式 ：content``<think>reasoning_content</think>

本地部署的 minimax-m2 模型，没有太多兼容，聊天模板固定了 think 包含在 content，openaiSDK没有对其进行适配，需要自己手动分离，或者修改模型聊天模板（不太建议），回传也是同样；



## 模型结构化输入注意

模型接收上下文输入有一定规范，错误将导致模型输出报错；

### Json序列化失败

上下文输入必须符合json规范，一般用户消息不会有问题，主要集中在工具消息和处理模型消息容易出问题：缺符号 } “ 等；

做好工具调用的异常、失败处理；

做好兜底机制，防止接收模型消息时网络波动、流式接收错误等原因造成json格式错误；

一般大部分业务有json检查，但检查到json序列化失败后，**要对其进行处理**（删除该消息、文本化等），直接回传模型一般会报错。

目前尝试过的官方api：

- 豆包兼容性最好，内部处理（不确定是删除还是修复处理）；
- 其他qwen3、minimax-m2均响应错误；

### 上下文输入合理性

上下文输入的第一条消息 role 不能为 tool ，只能是 user、assistant 角色。不然模型报错（豆包兼容）。注意输入前上下文的处理机制；

上下文输入全部消息中，tool 响应消息的 task_call_id 必须相对应ai工具命令的 task_call_id ；即调用工具消息和工具响应消息必须对应；一般需要注意删除消息机制实现；